# .github/workflows/nf-test.yml
name: nf-test
on:
  push: { branches: [main] }
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }

      # Installs nf-test on the runner (pick a version or omit for latest)
      - uses: nf-core/setup-nf-test@v1
        with:
          nf-test-version: v0.9.3   # or leave blank for latest

      # Nextflow (nf-test needs it)
      - name: Install Nextflow
        run: |
          curl -s https://get.nextflow.io | bash
          sudo mv nextflow /usr/local/bin/nextflow
          nextflow -version

      # Run either all tests, or only those touched in this PR
      - name: Run nf-test (changed files only)
        if: github.event_name == 'pull_request'
        run: nf-test test --changes-since origin/${{ github.base_ref }}

      - name: Run nf-test (full)
        if: github.event_name != 'pull_request'
        run: nf-test test
